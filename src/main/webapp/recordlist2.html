<!DOCTYPE html>
<html lang="en">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>领料单查询</title>

<!-- Bootstrap Core CSS -->
<link href="css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/bootstrap-table.css" />
<link rel="stylesheet" href="css/bootstrap-select.min.css" />

<!-- Custom CSS -->
<link href="css/sb-admin.css" rel="stylesheet">
<script src="js/jquery.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="js/bootstrap.min.js"></script>
<script src="js/bootstrap-table.min.js"></script>
<script src="js/bootstrap-table-zh-CN.min.js"></script>
<script src="js/bootstrap-select.min.js"></script>
<!-- Morris Charts CSS -->
<link href="css/plugins/morris.css" rel="stylesheet">


<!-- Custom Fonts -->
<link href="font-awesome/css/font-awesome.min.css" rel="stylesheet"
	type="text/css">

<style type="text/css">
.aa {
	background-color: #000;
}
.row_table table{
	width:80%;
}
</style>
</head>

<body>

	<div id="wrapper">

		<!-- Navigation -->
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="javascript:void(0)">领料记录</a>
			</div>
			<!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav side-nav">
					<li><a href="#" data-toggle="collapse" data-target="#demo"
						aria-haspopup="true" aria-expanded="true"><i
							class="fa fa-fw fa-dashboard"></i> 纺机管理<i
							class="fa fa-fw fa-caret-down"></i></a>
						<ul id="demo" class="collapse ">
							<li><a href="main.html">机器信息查询</a></li>
							<li><a href="main_machineinfo.html">机器管理</a></li>
						</ul></li>

					<li><a href="#" data-toggle="collapse" data-target="#demo2"
						aria-haspopup="true" aria-expanded="true"><i
							class="glyphicon glyphicon-zoom-in"></i> 历史记录<i
							class="fa fa-fw fa-caret-down"></i></a>
						<ul id="demo2" class="collapse in  nav-pills nav-stacked "
							aria-expanded="true">
							<li><a href="recordlist.html">故障记录</a></li>
							<li><a href="recordlist1.html">保养记录</a></li>
							<li class="aa"><a href="recordlist2.html">领料记录</a></li>
						</ul></li>


					<li><a href="javascript:;" data-toggle="collapse"
						data-target="#demo1"><i class="glyphicon glyphicon-pencil"></i>
							用户权限 <i class="fa fa-fw fa-caret-down"></i></a>
						<ul id="demo1" class="collapse">
							<li><a href="permissions.html">权限分配</a></li>
							<li><a href="updateuser.html">权限管理</a></li>
						</ul></li>
					<li><a href="special-fault.html"><i
							class="fa fa-fw fa-table"></i>故障库导入</a></li>
					<li><a href="fault.html"><i class="fa fa-fw fa-edit"></i>
							提交故障</a></li>
					<li><a href="fault-review.html"><i
							class="fa fa-fw fa-desktop"></i> 故障审核</a></li>

					<li><a href="picking2.html"><i class="glyphicon glyphicon-list-alt"></i> 申请领料</a>
					<li><a href="board.html" target="_blank"><i class="fa fa-fw fa-file"></i>进入看板</a>
					</li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</nav>

		<div id="page-wrapper">

			<div class="container-fluid">

				<!-- Page Heading -->
				<div class="row">
					<div class="col-lg-12">
						<h1 class="page-header">领料单</h1>
					</div>
				</div>
				<div class="row">
					<select class="selectpicker" id="mchine_conditions_select">
						<option>输入故障单号查询</option>

					</select> <input type="text" id="mchine_conditions">
					<button class="btn" onclick="table_lld()">查询</button>

				</div>
				<div style="padding: 30px"></div>
				<div class="row_table">
					<table id="show_parts_date1"></table>
				</div>
				<div class="row">
					<!-- <div style="padding: 300px"></div> -->
				</div>
			</div>

		</div>
	</div>

	<script type="text/javascript">
		function table_lld(){
			var val=document.getElementById('mchine_conditions').value;
			if(val==""){
				alert("请先填写信息");
				return;
			}
			$.ajax({
				type:"POST",
				url:"./xinyi/Material/materialsById",
				data:{
					id:val
				},
				statusCode : {
					404 : function() {
						alert("404");
					},
					500 : function() {
						alert("500");
					}
				},
				success : function(message, Status) {
					let item=[];
					let resultArr = [];
					let json=eval(message);
					for(let i=0;i<json.length;i++){
						let msg=eval(json[i]);
						console.log(msg[0]);
						msg.forEach(it=>{item.push(it)});
//						let material=msg[0]["material"];
//						let materialId=msg[0]['materialId'];
//						let number=msg[0]['number'];
//						let unit=msg[0]['unit'];
//						item[i]['material']=material;
//						item[i]['materialId']=materialId;
//						item[i]['number']=number;
//						item[i]['unit']=unit;
					}
					console.log({item});
					item.forEach(item=>{
						let index = resultArr.findIndex(materialInfo=>materialInfo.material==item.material);
						if(index!=-1){
							resultArr[index].number +=item.number;
						}else{
							resultArr.push(JSON.parse(JSON.stringify(item)));
						}
					})
					console.log({resultArr});
				
						
						show_parts_data1(resultArr);
					
					
				} 
			});
			

		}
		function show_parts_data1(json){
			$('#show_parts_date1').bootstrapTable({
				columns:[{
					field:"materialId",
					title:"零件ID"
				},{
					field:"material",
					title:"零件名称"
				},{
					field:"number",
					title:"数量"
				},{
					field:"unit",
					title:"单位"
				}],
				data:json,
				sortable: false,   
				pageList : [ 5,10,20],
				pageSize : 5,

			});
		}
	</script>


</body>

</html>
